<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8"/>
	<title>Kakao 지도 시작하기</title>
</head>
<body>
	<div id="map" style="width:75vw;height:100vh;margin-left:25vw;"></div>
	<div style="position:absolute; top:10px; left:10px; width:20vw;">
		<input type="text" id="startSearchBox" placeholder="출발지 검색" style="width:100%; padding:10px; margin-bottom:10px;">
		<button id="setStart" style="margin-bottom:20px;">출발지 설정</button>
		<input type="text" id="endSearchBox" placeholder="목적지 검색" style="width:100%; padding:10px; margin-bottom:10px;">
		<button id="setEnd" style="margin-bottom:20px;">목적지 설정</button>
	</div>
	<div style="position:absolute; top:200px; left:10px; width:20vw;">
		<p>출발좌표: <span id="startCoords">N/A</span></p>
		<p>목적좌표: <span id="endCoords">N/A</span></p>
		<p>거리계산: <span id="distance">N/A</span></p>
	</div>
	<script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=510b624b2b131b82ad7aee34c7864031&libraries=services"></script>
	<script>
		window.onload = function () {
			kakao.maps.load(function () {
				var container = document.getElementById('map');
				var options = {
					center: new kakao.maps.LatLng(33.450701, 126.570667),
					level: 3
				};

				var map = new kakao.maps.Map(container, options);

				// 장소 검색 객체를 생성합니다
				var ps = new kakao.maps.services.Places();

				// 검색 결과 목록이나 마커를 클릭했을 때 장소명을 표출할 인포윈도우를 생성합니다
				var infowindow = new kakao.maps.InfoWindow({zIndex:1});

				var startMarker, endMarker, line;

				document.getElementById('setStart').addEventListener('click', function() {
					var keyword = document.getElementById('startSearchBox').value;
					ps.keywordSearch(keyword, function(data, status) {
						if (status === kakao.maps.services.Status.OK) {
							var position = new kakao.maps.LatLng(data[0].y, data[0].x);
							if (startMarker) startMarker.setMap(null);
							startMarker = new kakao.maps.Marker({
								map: map,
								position: position
							});
							drawLine();
						}
					});
				});

				document.getElementById('setEnd').addEventListener('click', function() {
					var keyword = document.getElementById('endSearchBox').value;
					ps.keywordSearch(keyword, function(data, status) {
						if (status === kakao.maps.services.Status.OK) {
							var position = new kakao.maps.LatLng(data[0].y, data[0].x);
							if (endMarker) endMarker.setMap(null);
							endMarker = new kakao.maps.Marker({
								map: map,
								position: position
							});
							drawLine();
						}
					});
				});

				function updateInfo() {
					if (startMarker) {
						var startPos = startMarker.getPosition();
						document.getElementById('startCoords').innerText = startPos.getLat() + ', ' + startPos.getLng();
					}
					if (endMarker) {
						var endPos = endMarker.getPosition();
						document.getElementById('endCoords').innerText = endPos.getLat() + ', ' + endPos.getLng();
					}
					if (startMarker && endMarker) {
						var distance = kakao.maps.geometry.spherical.computeDistanceBetween(startMarker.getPosition(), endMarker.getPosition());
						document.getElementById('distance').innerText = (distance / 1000).toFixed(2) + ' km';
					}
				}

				function drawLine() {
					if (startMarker && endMarker) {
						if (line) line.setMap(null);
						var linePath = [
							startMarker.getPosition(),
							endMarker.getPosition()
						];
						line = new kakao.maps.Polyline({
							path: linePath,
							strokeWeight: 5,
							strokeColor: '#FF0000',
							strokeOpacity: 0.7,
							strokeStyle: 'solid'
						});
						line.setMap(map);
						updateInfo();
					}
				}

				// 지도에 클릭 이벤트를 등록합니다
				// kakao.maps.event.addListener(map, 'click', function(mouseEvent) {
				//     // 클릭한 위치의 좌표입니다
				//     var latlng = mouseEvent.latLng;

				//     // 커스텀 오버레이에 표시할 내용입니다
				//     var content = '<div style="padding:5px;">' +
				//                   '<img src="https://via.placeholder.com/150" alt="클릭 이미지" style="width:100%;"/>' +
				//                   '</div>';

				//     // 커스텀 오버레이를 생성합니다
				//     var overlay = new kakao.maps.CustomOverlay({
				//         content: content,
				//         map: map,
				//         position: latlng
				//     });

				//     // 클릭한 위치에 커스텀 오버레이를 표시합니다
				//     overlay.setMap(map);
				// });
			});
		};
	</script>
</body>
</html>